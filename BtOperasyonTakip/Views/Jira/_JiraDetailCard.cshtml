@model BtOperasyonTakip.Models.JiraTask

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
            <h5 class="mb-1">🧾 @Model.JiraId</h5>
            <div class="text-muted small">
                👤 @Model.TalepAcan &nbsp;|&nbsp; 🕓 @Model.OlusturmaTarihi.ToString("dd.MM.yyyy HH:mm")
            </div>
        </div>

        <div class="d-flex gap-2">
            <select id="ddlDurum_@Model.Id" class="form-select form-select-sm">
                @foreach (var s in new[] { "Beklemede", "Aktif", "Tamamlandı" })
                {
                    if (string.Equals(Model.Durum, s, System.StringComparison.OrdinalIgnoreCase))
                    {
                        <option value="@s" selected>@s</option>
                    }
                    else
                    {
                        <option value="@s">@s</option>
                    }
                }
            </select>

            <button class="btn btn-sm btn-outline-primary" data-action="update-status" data-id="@Model.Id">
                Kaydet
            </button>
            <button class="btn btn-sm btn-outline-danger" data-action="delete-task" data-id="@Model.Id">Sil</button>
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">Talep Konusu</label>
        <input class="form-control" value="@Model.TalepKonusu" disabled />
    </div>

    <hr />

    <h6 class="mb-2">💬 Yorumlar</h6>
    @if (Model.Yorumlar != null && Model.Yorumlar.Any())
    {
        <ul class="list-group mb-3">
            @foreach (var y in Model.Yorumlar.OrderByDescending(x => x.Tarih))
            {
                <li class="list-group-item">
                    <div class="d-flex justify-content-between">
                        <strong>@y.Ekleyen</strong>
                        <small class="text-muted">@y.Tarih.ToString("dd.MM.yyyy HH:mm")</small>
                    </div>
                    <div class="mt-1">@y.YorumMetni</div>
                </li>
            }
        </ul>
    }
    else
    {
        <p class="text-muted">Henüz yorum yok.</p>
    }

    <form id="frmYorumEkle_@Model.Id" method="post" action="/Jira/AddYorum" class="row g-2">
        @Html.AntiForgeryToken()
        <input type="hidden" name="jiraTaskId" value="@Model.Id" />
        <div class="col-8 col-md-9">
            <input name="yorum" class="form-control" placeholder="Yeni yorum yaz..." required />
        </div>
        <div class="col-4 col-md-3">
            <input name="ekleyen" class="form-control" placeholder="Ekleyen" value="@(User?.Identity?.Name ?? "Sistem")" />
        </div>
        <div class="col-12">
            <button type="submit" class="btn btn-success w-100">💾 Yorum Ekle</button>
        </div>
    </form>
</div>